import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as r,a as i,d,w as l,r as c,o as k,e as s}from"./app-Dn2gJQev.js";const o={};function u(p,e){const t=c("Tabs");return k(),r("div",null,[e[6]||(e[6]=i("h1",{id:"创建-ssl-证书",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#创建-ssl-证书"},[i("span",null,"创建 SSL 证书")])],-1)),e[7]||(e[7]=i("p",null,"本页将为您介绍如何为面板和 Wings 创建新的 SSL 证书",-1)),d(t,{data:[{id:"方法 1: Certbot"},{id:"方法 2: acme.sh (使用 Cloudflare API)"},{id:"方法 3: Caddy（使用 Cloudflare API）"}]},{title0:l(({value:a,isActive:n})=>[...e[0]||(e[0]=[s("方法 1: Certbot",-1)])]),title1:l(({value:a,isActive:n})=>[...e[1]||(e[1]=[s("方法 2: acme.sh (使用 Cloudflare API)",-1)])]),title2:l(({value:a,isActive:n})=>[...e[2]||(e[2]=[s("方法 3: Caddy（使用 Cloudflare API）",-1)])]),tab0:l(({value:a,isActive:n})=>[...e[3]||(e[3]=[i("p",null,[s("首先,我们将安装 Certbot,这是一个脚本文件,它可以自动更新证书并一键创建证书。下面的命令只适合 Ubuntu，但您可以在 "),i("a",{href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"},"Certbot 官方网站"),s("查看相关安装说明,我们这里包含了安装 Certbot 必要的Nginx或Apache插件的指令,这样妈妈再也不用担心我需要迁移环境了!")],-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," apt"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," update")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," apt"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -y"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," certbot")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# Nginx 插件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," apt"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -y"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," python3-certbot-nginx")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# Apache 插件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," apt"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -y"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," python3-certbot-apache")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("h2",{id:"创建证书",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#创建证书"},[i("span",null,"创建证书")])],-1),i("p",null,"安装Certbot之后我们需要生成一个证书,最简单的方法就是安装Web服务器的Certbot插件,如果没有Web服务器的话就需要DNS验证了",-1),i("p",null,[s("在下面命令中,请您替换 "),i("code",null,"example.com"),s(" 域名为您自己需要生成证书的域名,当您需要申请多个域名的证书时可以在每个域名前面添加 "),i("code",null,"-d"),s(" 参数 ，列如 "),i("code",null,"-d anotherdomain.com"),s("，当然您还可以考虑生成通配符证书，但本教程未涉及。")],-1),i("h3",{id:"http-验证",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#http-验证"},[i("span",null,"HTTP 验证")])],-1),i("p",null,"HTTP 验证需要您开放服务器 80 端口来进行验证",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# Nginx")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"certbot"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," certonly"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --nginx"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -d"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," example.com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# Apache")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"certbot"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," certonly"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --apache"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -d"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," example.com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 如果以上两者都不起作用您可以试试这个,但是用之前请确保Web服务器已经关闭")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"certbot"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," certonly"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --standalone"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -d"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," example.com")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("h3",{id:"dns-验证",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#dns-验证"},[i("span",null,"DNS 验证")])],-1),i("p",null,"DNS 验证要求您去您的域名购买商那里解析相应的TXT DNS记录值以验证域名所有权，而不必公开 80 端口。在运行下面的 certbot 命令时会显示说明。",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"certbot"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -d"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," example.com"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --manual"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --preferred-challenges"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," dns"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," certonly")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("h3",{id:"自动续签",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#自动续签"},[i("span",null,"自动续签")])],-1),i("p",null,[s("您可以配置证书自动续签以防止证书过期,您可以使用 "),i("code",null,"sudo crontab -e"),s(" 打开 crontab 来添加下面的代码,该代码将在每天 23点 (晚上11点)都会检查一遍SSL证书是否过期并尝试续签")],-1),i("p",null,[s("部署成功后将会自动重启 Nginx 并应用新的 SSL 证书,您可以将 "),i("code",null,"systemctl restart nginx"),s(" 中的 "),i("code",null,"nginx"),s(" 更改为 "),i("code",null,"apache"),s(" 或 "),i("code",null,"wings")],-1),i("p",null,[s("对更高级的用户来说,我们建议使用 "),i("a",{href:"https://acme.sh",target:"_blank",rel:"noopener noreferrer"},"acme.sh"),s(" ，它提供了更多更强大的功能")],-1),i("div",{class:"language-text line-numbers-mode","data-highlighter":"shiki","data-ext":"text",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-text"},[i("span",{class:"line"},[i("span",null,'0 23 * * * certbot renew --quiet --deploy-hook "systemctl restart nginx"')])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("h3",{id:"疑难解答",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#疑难解答"},[i("span",null,"疑难解答")])],-1),i("p",null,[s("如果您在尝试访问面板或 Wings 时遇到 "),i("code",null,"不安全连接"),s(" 或 SSL/TLS 相关的错误时,有可能是您的 SSL 证书过期了,您可以通过更新 SSL 证书来解决,如果您的 80 端口正在被占用那就无法使用 "),i("code",null,"certbot-renew"),s(" 来完成自动续签")],-1),i("p",null,[s("如果您运行的是 Nginx,在运行 Certbot 并附带有 "),i("code",null,"-nginx"),s(" 时出现报错您可以先停止 Nginx 服务后来续签证书，然后再启动 Nginx,如果您在为 Wings 续签证书，那你可以替换为 "),i("code",null,"wings")],-1),i("p",null,"停止 Nginx:",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," stop"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," nginx")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("p",null,"续签证书:",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"certbot"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," renew")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("p",null,"在完成续签后请使用下面的命令来重启 Nginx:",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," start"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," nginx")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("p",null,"您可能还需要重新启动 Wings，因为并非每个服务都能够自动应用更新的证书：",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," restart"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," wings")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1)])]),tab1:l(({value:a,isActive:n})=>[...e[4]||(e[4]=[i("p",null,[s("该方法适合高级用户和无法开放80端口的用户, 下面的命令适用于 Ubuntu 和 Cloudflare API,您可以查看 "),i("a",{href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"},"acme.sh 的官方网站"),s(" 来获取相关说明。请务必阅读这两个说明，因为有些人可能已经迁移到 CloudFlare 的"),i("a",{href:"https://blog.cloudflare.com/permissions-best-practices",target:"_blank",rel:"noopener noreferrer"},"新授权系统"),s("（新版），但其他人"),i("a",{href:"https://cloudflare.tv/event/ea8JJLgR",target:"_blank",rel:"noopener noreferrer"},"尚未迁移"),s("（旧版）。")],-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"curl"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," https://get.acme.sh"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," | "),i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sh")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("h3",{id:"获取-cloudflare-api-密钥-旧版",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#获取-cloudflare-api-密钥-旧版"},[i("span",null,"获取 Cloudflare API 密钥（旧版）")])],-1),i("p",null,"安装 acme.sh 后，我们需要获取 CloudFlare API 密钥。 在 Cloudfare 的网站上，选择您的域名，然后在右侧复制您的 “区域 ID” 和 “帐户 ID”，然后单击 “获取您的 API 令牌”，单击 “创建令牌” > 选择模板 “编辑区域 DNS” > 选择 “区域资源” 的范围，然后单击 “继续以显示摘要”，复制您的令牌。",-1),i("h3",{id:"申请证书",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#申请证书"},[i("span",null,"申请证书")])],-1),i("p",null,"由于配置文件基于 Certbot,所以我们需要手动创建一个文件夹",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," mkdir"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -p"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/letsencrypt/live/example.com")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("p",null,"安装 acme 之后执行它并获取 Cloudflare 的 API 密钥,然后输入 Cloudflare 的 API 凭据来生成证书",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}}," CF_Token"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},'"Your_CloudFlare_API_Key"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}}," CF_Account_ID"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},'"Your_CloudFlare_Account_ID"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}}," CF_Zone_ID"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},'"Your_CloudFlare_Zone_ID"')])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("h3",{id:"获取-cloudflare-api-密钥-新版",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#获取-cloudflare-api-密钥-新版"},[i("span",null,"获取 CloudFlare API 密钥（新版）")])],-1),i("p",null,[s("安装 acme.sh 后，我们需要获取 CloudFlare API 密钥。在 Cloudflare 的网站上，点击右上角的个人资料。然后进入“我的资料”，在左侧找到“API 令牌”。点击它会带你到 "),i("a",{href:"https://dash.cloudflare.com/profile/api-tokens",target:"_blank",rel:"noopener noreferrer"},"API 令牌页面"),s("。选择“创建令牌”并使用“编辑区域 DNS”模板。然后在下一页，进入“区域资源”并选择“包含” - “特定区域” - （选择你要使用的域）。然后继续到摘要。确认你想创建令牌。")],-1),i("h3",{id:"创建证书-1",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#创建证书-1"},[i("span",null,"创建证书")])],-1),i("p",null,"由于配置文件基于 Certbot，我们需要手动创建文件夹。",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," mkdir"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -p"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/letsencrypt/live/example.com")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("p",null,"安装 acme.sh 并获取 CloudFlare API 密钥后，我们需要生成证书。首先，输入 CloudFlare API 凭证。",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}}," CF_Key"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},'"Your_CloudFlare_API_Key"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}}," CF_Email"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},'"Your_CloudFlare_Email"')])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("p",null,"然后创建证书。由于 API 密钥绑定到域名，Cloudflare 应该只允许你生成一个。",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"acme.sh"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --issue"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --dns"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," dns_cf"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -d"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "example.com"'),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --server"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," letsencrypt"),i("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"--key-file "),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"/etc/letsencrypt/live/example.com/privkey.pem"),i("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"--fullchain-file "),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"/etc/letsencrypt/live/example.com/fullchain.pem")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("h3",{id:"自动续签-1",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#自动续签-1"},[i("span",null,"自动续签")])],-1),i("p",null,"第一次运行脚本后,它将自动添加到 crontab,您可以使用以下命令来编辑自动续订间隔",-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," crontab"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -e")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1)])]),tab2:l(({value:a,isActive:n})=>[...e[5]||(e[5]=[i("p",null,[s("这适用于高级用户，他们正在使用 Cloudflare 代理模式或无法访问端口 "),i("code",null,"80"),s(".")],-1),i("h3",{id:"使用-cloudflare-dns-插件安装-caddy",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#使用-cloudflare-dns-插件安装-caddy"},[i("span",null,"使用 Cloudflare DNS 插件安装 Caddy")])],-1),i("p",null,"Caddy 默认不带有 Cloudflare DNS 插件，您需要自行安装。",-1),i("p",null,"有两种主要方法:",-1),i("ol",null,[i("li",null,[s("使用 "),i("code",null,"xcaddy"),s(" - 用于构建自己的 Caddy 版本的 CLI 工具")]),i("li",null,[s("从 "),i("a",{href:"https://caddyserver.com/download",target:"_blank",rel:"noopener noreferrer"},"Caddy 的下载页面"),s("下载预构建的二进制文件。")]),i("li",null,[s("使用 Ansible 下载并安装带有插件的 Caddy。请参阅 "),i("a",{href:"https://github.com/caddy-ansible/caddy-ansible",target:"_blank",rel:"noopener noreferrer"},"caddy-ansible")])],-1),i("h4",{id:"在您的服务器上使用-xcaddy-构建-caddy",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#在您的服务器上使用-xcaddy-构建-caddy"},[i("span",null,[s("在您的服务器上使用 "),i("code",null,"xcaddy"),s(" 构建 Caddy")])])],-1),i("p",null,[s("请参阅 "),i("a",{href:"https://caddyserver.com/docs/build#xcaddy",target:"_blank",rel:"noopener noreferrer"},"Caddy 构建文档"),s("。")],-1),i("h3",{id:"获取-cloudflare-api-令牌",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#获取-cloudflare-api-令牌"},[i("span",null,"获取 CloudFlare API 令牌")])],-1),i("p",null,"在安装 acme.sh 后，我们需要获取 CloudFlare API 密钥。请确保 DNS 记录（A 记录或 CNAME 记录）指向您的目标节点，并将云设置为灰色（绕过 CloudFlare 代理）。然后转到“我的配置文件”>“API 密钥”，在全局 API 密钥子选项卡上，单击“查看”，输入您的 CloudFlare 密码，并将 API 密钥复制到剪贴板。",-1),i("p",null,[s("在安装带有 Cloudflare DNS 插件的 Caddy 后，我们需要获取 Cloudflare API 令牌。请确保 DNS 记录（A 记录或 CNAME 记录）指向您的目标节点。然后转到“我的配置文件”>“API 令牌”，在 API 令牌上单击“创建令牌”。创建 API 令牌 > API 令牌模板，在带有“编辑区域 DNS”的行末尾，单击“使用模板”。在"),i("strong",null,"区域资源"),s("下，选择您希望创建 API 令牌的 DNS 区域，单击“继续到摘要”。查看 API 令牌摘要，然后单击“创建令牌”。最后将 API 令牌复制到剪贴板。")],-1),i("h3",{id:"重新配置-caddy-以使用-cloudflare-dns-获取证书",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#重新配置-caddy-以使用-cloudflare-dns-获取证书"},[i("span",null,"重新配置 Caddy 以使用 Cloudflare DNS 获取证书")])],-1),i("p",null,[s("首先，您需要创建一个环境变量文件（例如 "),i("code",null,".env"),s("），请注意，此文件包含机密信息，不应该被公开访问。")],-1),i("p",null,[s("我们建议您将此机密文件放在以下位置: "),i("code",null,"/etc/caddy/.secrets.env"),s("。")],-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}},"CLOUDFLARE_API_TOKEN"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"<"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"您的"),i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}}," Cloudflare"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," API"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 令"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"牌>")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),i("p",null,[s("出于安全原因，我们建议将权限设置为 "),i("code",null,"0600"),s(" （只有所有者可以读取或写入文件）。")],-1),i("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-bash"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 将 `.secrets.env` 文件的所有权设置为 `caddy` 系统用户")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"chown"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," caddy:caddy"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/caddy/.secrets.env")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 仅允许所有者读写权限 - 即 `caddy` 系统用户")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"chmod"),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," 0600"),i("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/caddy/.secrets.env")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("p",null,[s("接下来，修改 systemd 单元文件，以从文件加载环境变量（在 "),i("code",null,"ExecStart"),s(" 中添加 "),i("code",null,"--envfile /etc/caddy/.secrets.env"),s(" 标志）。默认的 systemd 单元文件位置是 "),i("code",null,"/etc/systemd/system/caddy.service"),s(":")],-1),i("div",{class:"language-unit line-numbers-mode","data-highlighter":"shiki","data-ext":"unit",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-unit"},[i("span",{class:"line"},[i("span",null,"[Unit]")]),s(`
`),i("span",{class:"line"},[i("span",null,"Description=Caddy")]),s(`
`),i("span",{class:"line"},[i("span",null,"Documentation=https://caddyserver.com/docs/")]),s(`
`),i("span",{class:"line"},[i("span",null,"After=network.target network-online.target")]),s(`
`),i("span",{class:"line"},[i("span",null,"Requires=network-online.target")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,"[Service]")]),s(`
`),i("span",{class:"line"},[i("span",null,"Type=notify")]),s(`
`),i("span",{class:"line"},[i("span",null,"User=caddy")]),s(`
`),i("span",{class:"line"},[i("span",null,"Group=caddy")]),s(`
`),i("span",{class:"line"},[i("span",null,"ExecStart=/usr/bin/caddy run --environ --envfile /etc/caddy/.secrets.env --config /etc/caddy/Caddyfile")]),s(`
`),i("span",{class:"line"},[i("span",null,"ExecReload=/usr/bin/caddy reload --config /etc/caddy/Caddyfile")]),s(`
`),i("span",{class:"line"},[i("span",null,"TimeoutStopSec=5s")]),s(`
`),i("span",{class:"line"},[i("span",null,"LimitNOFILE=1048576")]),s(`
`),i("span",{class:"line"},[i("span",null,"LimitNPROC=512")]),s(`
`),i("span",{class:"line"},[i("span",null,"PrivateTmp=true")]),s(`
`),i("span",{class:"line"},[i("span",null,"ProtectSystem=full")]),s(`
`),i("span",{class:"line"},[i("span",null,"AmbientCapabilities=CAP_NET_BIND_SERVICE")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,"[Install]")]),s(`
`),i("span",{class:"line"},[i("span",null,"WantedBy=multi-user.target")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("p",null,[s("最后，在您的面板配置的 "),i("code",null,"<domain>"),s(" 块下，您可以在 "),i("code",null,"Caddyfile"),s(" 中添加一个 "),i("code",null,"tls"),s(" 块。Caddy 配置文件的位置是 "),i("code",null,"/etc/caddy/Caddyfile"),s(":")],-1),i("div",{class:"language-caddyfile line-numbers-mode","data-highlighter":"shiki","data-ext":"caddyfile",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-caddyfile"},[i("span",{class:"line"},[i("span",null,"<domain> {")]),s(`
`),i("span",{class:"line"},[i("span",null,"  # ...")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,"  tls {")]),s(`
`),i("span",{class:"line"},[i("span",null,"    dns cloudflare {env.CLOUDFLARE_API_TOKEN}")]),s(`
`),i("span",{class:"line"},[i("span",null,"  }")]),s(`
`),i("span",{class:"line"},[i("span",null,"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])]),_:1})])}const b=h(o,[["render",u]]),y=JSON.parse('{"path":"/tutorials/creating_ssl_certificates.html","title":"创建 SSL 证书","lang":"zh-CN","frontmatter":{"description":"创建 SSL 证书 本页将为您介绍如何为面板和 Wings 创建新的 SSL 证书","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"创建 SSL 证书\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-09-29T18:20:26.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://pterodactyl.top/tutorials/creating_ssl_certificates.html"}],["meta",{"property":"og:site_name","content":"Pterodactyl-China"}],["meta",{"property":"og:title","content":"创建 SSL 证书"}],["meta",{"property":"og:description","content":"创建 SSL 证书 本页将为您介绍如何为面板和 Wings 创建新的 SSL 证书"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-29T18:20:26.000Z"}],["meta",{"property":"article:modified_time","content":"2024-09-29T18:20:26.000Z"}]]},"git":{"createdTime":1532407839000,"updatedTime":1727634026000,"contributors":[{"name":"Dane Everitt","username":"","email":"dane@daneeveritt.com","commits":2},{"name":"Ethereal739","username":"Ethereal739","email":"42406302+Ethereal739@users.noreply.github.com","commits":1,"url":"https://github.com/Ethereal739"},{"name":"Riley","username":"Riley","email":"rileykotarba@gmail.com","commits":1,"url":"https://github.com/Riley"},{"name":"ckykenken","username":"ckykenken","email":"26035978+ckykenken@users.noreply.github.com","commits":1,"url":"https://github.com/ckykenken"},{"name":"DiscoverSquishy","username":"DiscoverSquishy","email":"noaimi2214@gmail.com","commits":2,"url":"https://github.com/DiscoverSquishy"},{"name":"Lance Pioch","username":"","email":"git@lance.sh","commits":3},{"name":"TekExplorer","username":"TekExplorer","email":"30291302+TekExplorer@users.noreply.github.com","commits":3,"url":"https://github.com/TekExplorer"},{"name":"Pemigrade","username":"Pemigrade","email":"43528123+Pemigrade@users.noreply.github.com","commits":1,"url":"https://github.com/Pemigrade"},{"name":"GoldenEdit","username":"GoldenEdit","email":"45533337+GoldenEdit@users.noreply.github.com","commits":1,"url":"https://github.com/GoldenEdit"},{"name":"Thierry","username":"Thierry","email":"thierrylafeber@hotmail.com","commits":1,"url":"https://github.com/Thierry"},{"name":"Alex","username":"Alex","email":"admin@softwarenoob.com","commits":1,"url":"https://github.com/Alex"},{"name":"Khisab Kurniawan","username":"","email":"khisabkurniawan@outlook.com","commits":1},{"name":"saltedfisholdxu","username":"saltedfisholdxu","email":"52811930+saltedfisholdxu@users.noreply.github.com","commits":1,"url":"https://github.com/saltedfisholdxu"},{"name":"BuildTools","username":"BuildTools","email":"unconfigured@null.spigotmc.org","commits":1,"url":"https://github.com/BuildTools"},{"name":"vlssu","username":"vlssu","email":"43847794+vlssu@users.noreply.github.com","commits":4,"url":"https://github.com/vlssu"},{"name":"DeDiamondPro","username":"DeDiamondPro","email":"67508414+DeDiamondPro@users.noreply.github.com","commits":1,"url":"https://github.com/DeDiamondPro"},{"name":"BakiDance","username":"BakiDance","email":"43658058+BakiDance@users.noreply.github.com","commits":1,"url":"https://github.com/BakiDance"},{"name":"Boy132","username":"Boy132","email":"Boy132@users.noreply.github.com","commits":1,"url":"https://github.com/Boy132"},{"name":"Vojtech Mares","username":"","email":"iam@vojtechmares.com","commits":3},{"name":"Verttigo28","username":"Verttigo28","email":"53260217+Verttigo28@users.noreply.github.com","commits":1,"url":"https://github.com/Verttigo28"},{"name":"MaddDogg98","username":"MaddDogg98","email":"jdmon1998@gmail.com","commits":1,"url":"https://github.com/MaddDogg98"},{"name":"Stefano","username":"Stefano","email":"stefano@stefanocoding.me","commits":1,"url":"https://github.com/Stefano"},{"name":"rowansc1","username":"rowansc1","email":"37227235+rowansc1@users.noreply.github.com","commits":3,"url":"https://github.com/rowansc1"}]},"readingTime":{"minutes":6.87,"words":2060},"filePathRelative":"tutorials/creating_ssl_certificates.md","autoDesc":true}');export{b as comp,y as data};
